--USE superbill_49117_dev
USE superbill_49117_prod
go

SET XACT_ABORT ON

BEGIN TRANSACTION

SET NOCOUNT ON 

PRINT ''
PRINT 'Updating Doctor - Note...'
UPDATE dbo.Doctor 
	SET Notes = 'Practice Name: ' + i.practicename + CHAR(13) + CHAR(10) + CAST(d.Notes AS VARCHAR(MAX))
FROM dbo.Doctor d 
INNER JOIN dbo.[_import_27_1_ReferringProviderPracticeUpdate] i ON
	d.FirstName = i.firstname AND 
	d.LastName = i.lastname AND 
	d.AddressLine1 = i.address1 AND 
	d.City = i.city
WHERE d.[External] = 1 AND i.practicename <> '' AND d.PracticeID = 1
PRINT CAST(@@ROWCOUNT AS VARCHAR) + ' records updated'

PRINT ''
PRINT 'Updating Patient - SSN...'
UPDATE dbo.Patient 
	SET SSN = RIGHT('000' + dbo.fn_RemoveNonNumericCharacters(SSN), 9)
WHERE LEN(dbo.fn_RemoveNonNumericCharacters(SSN)) IN (6,7,8) AND PracticeID = 1
PRINT CAST(@@ROWCOUNT AS VARCHAR) + ' records updated'


--ROLLBACK
--COMMIT


SELECT i.providerid , i.firstname , i.lastname , i.address1 , i.address2 , i.city , i.state , i.zip , i.practicename FROM dbo._import_27_1_ReferringProviderPracticeUpdate i

WHERE i.practicename <> '' AND
NOT EXISTS (SELECT * FROM dbo.Doctor d WHERE d.FirstName = i.firstname AND d.LastName = i.lastname AND d.AddressLine1 = i.address1 AND d.City = i.city AND d.[External] = 1)


SELECT * FROM dbo.Doctor WHERE FirstName = 'Irene' AND LastName = 'Chen'




SELECT * FROM dbo.Doctor WHERE FirstName = 'Kathleen' AND LastName = 'Solum'
SELECT * FROM dbo._import_27_1_ReferringProviderPracticeUpdate WHERE FirstName = 'Kathleen' AND LastName = 'Solum'


SELECT * FROM dbo.Doctor WHERE [External] = 1


















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































